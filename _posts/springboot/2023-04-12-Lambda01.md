---
title:  "AWS Lambdaë¥¼ ì´ìš©í•´ ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• ì ìš© - ì´ë¯¸ì§€ ë¡œë”© ì†ë„ ìµœì í™”" 
excerpt: "ì„œë²„ë¦¬ìŠ¤ ì»´í“¨íŒ… Faas"

categories:
  - Springboot
tags:
  - Springboot

date: 2023-04-12
last_modified_at: 2023-04-12

---

### 0. Intro
---

ì´ë¯¸ì§€ì™€ ê°™ì€ íŒŒì¼ì„ AWS S3ì— ì—…ë¡œë“œí•˜ë©´ ê°ì²´ URLì— ì ‘ê·¼í•˜ì—¬ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.

ì–´ë–¤ ì›¹ í˜ì´ì§€ì—ì„œ S3ì— ì €ì¥í•´ë‘” ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì™€ì•¼ í•œë‹¤ê³  ìƒê°í•´ë³´ì.

ì´ë¯¸ì§€ 1ê°œë¥¼ ë¶ˆëŸ¬ì™€ì•¼ í•œë‹¤ë©´ ì´ë¯¸ì§€ í¬ê¸°ê°€ ë¡œë”© ì†ë„ì— í° ì˜í–¥ì„ ì£¼ì§€ ì•Šì„ì§€ë„ ëª¨ë¥¸ë‹¤.

ë§Œì•½ ì—¬ëŸ¬ ì´ë¯¸ì§€ ì‚¬ì§„, ì´ë¥¼í…Œë©´ ë™ì‹œì— ìˆ˜ ë°±ê°œë¥¼ ë¶ˆëŸ¬ì™€ì„œ ì›¹ í˜ì´ì§€ë¥¼ ë¡œë”©í•´ì•¼í•œë‹¤ë©´??

ì´ë¯¸ì§€ í¬ê¸°ê°€ ë¡œë”© ì†ë„ì— í° ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤.

âœ… ê·¸ë ‡ê¸°ì— ë¹ ë¥¸ ì´ë¯¸ì§€ ë¡œë”©ì„ ìœ„í•´ì„œ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ëŠ” ê²ƒì€ ì¤‘ìš”í•œ ë¶€ë¶„ì´ë‹¤.

<br>

#### ğŸš¨ ë¬¸ì œ ìƒí™©

í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ì´ì™€ ê´€ë ¨í•œ ë¬¸ì œê°€ ìˆì—ˆë‹¤.

ìš°ì„ , ìƒí’ˆê³¼ ë¸Œëœë“œ ì´ë¯¸ì§€ë¥¼ ì›¹ í˜ì´ì§€ í•œ ê³³ì—ì„œ ë™ì‹œì— ë¶ˆëŸ¬ì˜¬ ì¼ì´ ë§ì„ ê²ƒì´ë¼ ì˜ˆìƒí–ˆë‹¤.

ë¿ ë§Œ ì•„ë‹ˆë¼, ì¸ë„¤ì¼ í˜¹ì€ ë¯¸ë¦¬ë³´ê¸°ì™€ ê°™ì€ ê³³ì—ì„œë„ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìƒí™©ì´ ë§ì„ ê²ƒì¸ë° **ì´ ë•Œ ì›ë³¸ ì´ë¯¸ì§€ ê·¸ëŒ€ë¡œë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤ë©´** ì´ë¯¸ì§€ í¬ê¸°ë¡œ ì¸í•´ ë¡œë”© ì†ë„ì— ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ë„ ìˆë‹¤ê³  ìƒê°í–ˆë‹¤.

<br>

#### â“ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ëŠ” ë°©ë²•

ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ëŠ” ë‹¨ìˆœí•œ ë°©ë²•ì€ 1ï¸âƒ£ **ì„œë²„ì—ì„œ ì§ì ‘ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¡°ì •í•˜ëŠ” ë¡œì§ì„ ì‘ì„±í•˜ëŠ” ê²ƒ**ì´ë‹¤.

ğŸš« ê·¸ëŸ°ë°, ì´ ë°©ë²•ì€ ì•ì„œ ë§í–ˆë“¯ì´ ë™ì‹œì— ë§ì€ ì´ë¯¸ì§€ë¥¼ ì¡°ì •í•˜ë ¤ê³  í•œë‹¤ë©´ CPU ë¦¬ì†ŒìŠ¤ë¥¼ ì¡ì•„ë¨¹ê¸° ë•Œë¬¸ì— ì„œë²„ì— ìƒë‹¹í•œ ë¶€í•˜ë¥¼ ì¤„ ìˆ˜ ìˆë‹¤.

ë‹¤ìŒìœ¼ë¡œ 2ï¸âƒ£ **AWS Lambdaë¥¼ ì´ìš©í•˜ëŠ” ë°©ë²•**ì´ ìˆë‹¤. 

<br>

#### AWS Lambda

AWS LambdaëŠ” ì„œë²„ë¦¬ìŠ¤ ì»´í“¨íŒ… Faas(Function as a Service)ì´ë‹¤.

ì—¬ê¸°ì„œ **ì„œë²„ë¦¬ìŠ¤**ë€ ê°œë°œìê°€ ì„œë²„ë¥¼ ê´€ë¦¬í•  í•„ìš” ì—†ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹Œë“œí•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤. 

ì¦‰, Lambdaì˜ ê²½ìš° AWSê°€ ì„œë²„ ì¸í”„ë¼ì— ëŒ€í•œ í”„ë¡œë¹„ì €ë‹, ìœ ì§€ ê´€ë¦¬ ë“±ì„ ëŒ€ì‹  ì²˜ë¦¬í•´ì¤€ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

ê°„ë‹¨íˆ ë§í•´, AWSê°€ ê°œë°œìê°€ í•  ì¼ì„ ëŒ€ì‹  ì²˜ë¦¬í•´ì¤€ë‹¤ëŠ” ëœ»ì´ë‹¤.

ì´ë ‡ê²Œ ë˜ë©´ ê°œë°œìëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‘ì„±ì— ì§‘ì¤‘í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

<br>

#### AWS Lambdaì™€ ì´ë¯¸ì§€ resizing

ë‹¤ì‹œ ë³¸ë¡ ìœ¼ë¡œ ëŒì•„ì™€, ì„œë²„ë¦¬ìŠ¤ ê°œë…ì— ë”°ë¥´ë©´, AWS Lambdaì— ì›í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ê³ , í•„ìš”í•  ë•Œ ê·¸ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œ ìš°ë¦¬ê°€ ì›í•˜ëŠ” ë™ì‘ì„ í•˜ê²Œë” í•  ìˆ˜ ìˆë‹¤ëŠ” ì˜ë¯¸ê°€ ëœë‹¤.

ê·¸ë ‡ë‹¤ë©´ Lambdaë¡œ ì–´ë–»ê²Œ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ ì˜ë¬¸ì´ ë“¤ ê²ƒì´ë‹¤.

ê°„ë‹¨í•˜ë‹¤. 

**ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¡°ì •í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•´ Lambdaì— ë“±ë¡í•´ë‘ì–´ Lambdaê°€ ì²˜ë¦¬í•˜ê²Œë” í•˜ëŠ” ê²ƒì´ë‹¤.**

ê³ ë§™ê²Œë„ AWS ê³µì‹ë¬¸ì„œì— ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§•ê³¼ ê´€ë ¨í•œ ì½”ë“œê°€ ìì„¸íˆ ë‚˜ì™€ìˆìœ¼ë©°, AWS LambdaëŠ” ë‹¤ë¥¸ AWS ì„œë¹„ìŠ¤ë“¤ê³¼ì˜ ì—°ë™ ë˜í•œ ìš©ì´í•˜ê¸°ì— S3 ë²„í‚·ì— ì €ì¥í•´ë‘” ì´ë¯¸ì§€ íŒŒì¼ì´ë¼ë©´ ì‰½ê²Œ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆë‹¤.

<br>

**ê·¸ë˜ì„œ ê²°ë¡ ì€, í”„ë¡œì íŠ¸ì—” ì´ AWS Lambdaë¥¼ ì´ìš©í•  ê²ƒì´ë‹¤.**

ë¸Œëœë“œ, ìƒí’ˆì„ ë“±ë¡í•  ë•Œ ì´ë¯¸ì§€ íŒŒì¼ì„ ë³´ë‚´ê²Œ ë í…ë° ì›ë³¸ ì´ë¯¸ì§€ íŒŒì¼ì´ ë“±ë¡ë¨ê³¼ ë™ì‹œì— Lambdaì˜ íŠ¸ë¦¬ê±°ê°€ ë™ì‘í•˜ê³ , ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• í•¨ìˆ˜ë¥¼ í†µí•´ì„œ í¬ê¸°ê°€ ì‘ì•„ì§„ ì´ë¯¸ì§€ íŒŒì¼ì„ ìƒì„±í•´ S3 ë²„í‚·ì— ì €ì¥í•˜ë„ë¡ í•  ê²ƒì´ë‹¤.


![image](https://user-images.githubusercontent.com/85394884/231692792-9b8b7c17-dd59-4d54-af17-0ab1b9e60087.png)


<br>

#### ì ìš© ìˆœì„œ

[AWS ê³µì‹ë¬¸ì„œ](https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/with-s3-tutorial.html)ì— ë³´ë©´ ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§•ì€ ì•„ë˜ì™€ ê°™ì€ ìˆœì„œë¥¼ ë°Ÿìœ¼ë©´ ëœë‹¤ê³  ë‚˜ì™€ìˆëŠ”ë°, ì´ë¥¼ ê¸°ë³¸ìœ¼ë¡œ í•˜ì—¬ ì§„í–‰í•´ë³´ê² ë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231554760-80f87946-0621-4359-ad19-4931342b7ab2.png)

<br>

### 1. IAM ì •ì±… ìƒì„±
---

ìš°ë¦° ì´ë¯¸ ë¸Œëœë“œ, ìƒí’ˆ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•  S3 ë²„í‚·ì´ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ë‹¨ê³„ 1ì€ íŒ¨ìŠ¤í•˜ê³ , IAM ì •ì±… ìƒì„± ë‹¨ê³„ë¡œ ë„˜ì–´ê°„ë‹¤.

IAM ì½˜ì†”ì˜ [ì •ì±… í˜ì´ì§€](https://us-east-1.console.aws.amazon.com/iamv2/home#/policies)ë¥¼ ì—´ê³ , ì•„ë˜ ì‚¬ì§„ì—ì„œ ì •ì±… ìƒì„± ë²„íŠ¼ì„ ëˆ„ë¥¸ë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231556292-763f2543-38f7-4115-8928-b99b37933002.png)

<br>

ì •ì±… ìƒì„± í˜ì´ì§€ì— ë“¤ì–´ì˜¤ë©´ JSON íƒ­ì„ ì„ íƒí•œ ë’¤ ì •ì±…ì„ ì…ë ¥í•´ì•¼ í•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231556589-61b941c5-c451-4944-a0f3-96b3984f9345.png)

<br>

ì •ì±…ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

ê°œì¸ë§ˆë‹¤ ë‹¬ë¼ì„œ ë°”ê¿”ì•¼ í•  ë¶€ë¶„ì€ `"Resource": "arn:aws:s3:::sourcebucket/*"`ì™€, `"Resource": "arn:aws:s3:::sourcebucket-resized/*"`ë¶€ë¶„ì´ë‹¤.

`sourcebucket`ë¶€ë¶„ì—” ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ë“±ë¡í•´ë‘” S3 ë²„í‚· ì´ë¦„ìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤.
 
`sourcebucket-resized`ë¶€ë¶„ì—” ë¦¬ì‚¬ì´ì§•í•œ ì´ë¯¸ì§€ë¥¼ ë“±ë¡í•  S3 ë²„í‚· ì´ë¦„ìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤.

ë‹¹ì—°íˆ, ë¦¬ì‚¬ì´ì§•í•œ ì´ë¯¸ì§€ë¥¼ ë“±ë¡í•  S3 ë²„í‚·ì€ ìƒì„±ëœ ìƒíƒœì—¬ì•¼ í•œë‹¤.

```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "logs:PutLogEvents",
                "logs:CreateLogGroup",
                "logs:CreateLogStream"
            ],
            "Resource": "arn:aws:logs:*:*:*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "s3:GetObject"
            ],
            "Resource": "arn:aws:s3:::sourcebucket/*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "s3:PutObject"
            ],
            "Resource": "arn:aws:s3:::sourcebucket-resized/*"
        }
    ]
}
```

<br>

íƒœê·¸ ì¶”ê°€ ë¶€ë¶„ì€ defaultë¡œ ë‘ê³ , ì•„ë˜ì™€ ê°™ì´ ì •ì±… ê²€í† ì˜ ì´ë¦„ì— `AWSLambdaS3Policy`ë¥¼ ì…ë ¥í•˜ê³ , ì •ì±… ìƒì„± ë²„íŠ¼ì„ ì„ íƒí•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231662411-f74d96f3-9c52-470a-b6b5-86e67db86c61.png)

<br>

### 2. ì‹¤í–‰ ì—­í•  ìƒì„±
---

ë‹¤ìŒìœ¼ë¡œ, Lambda í•¨ìˆ˜ì— AWS ë¦¬ì†ŒìŠ¤ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ì œê³µí•˜ëŠ” ì‹¤í–‰ ì—­í• ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤.

IAM ì½˜ì†”ì—ì„œ ì—­í•  í˜ì´ì§€ë¥¼ ì—°ë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231557084-c4a3b683-93b0-40e8-afe4-572fb4edbd5d.png)

<br>

ì—­í•  ë§Œë“¤ê¸°ë¥¼ ì„ íƒí•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231557275-45ac14ae-93a0-4f5f-8779-08ddaf9a1a07.png)

<br>

ë‹¤ìŒ ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ ì—­í• ì„ ë§Œë“ ë‹¤.

- ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì—”í„°í‹° â€“ `Lambda`
![image](https://user-images.githubusercontent.com/85394884/231559313-cb33233a-4515-4aa8-a119-d6c7eb966614.png)

<br>

- ê¶Œí•œ ì •ì±… â€“ `AWSLambdaS3Policy`
![image](https://user-images.githubusercontent.com/85394884/231559503-7244ad00-42e7-417b-8cd3-0e552fe5300c.png)

<br>

- ì—­í•  ì´ë¦„ â€“ `lambda-s3-role`
![image](https://user-images.githubusercontent.com/85394884/231559648-5bd86fcd-1de6-4402-82e7-721d3e4495af.png)

<br>

### 3. ë°°í¬ íŒ¨í‚¤ì§€ ìƒì„±
---

ì´ì œ ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§•ì„ ìœ„í•œ í•¨ìˆ˜ë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤.

ì—¬ëŸ¬ ì–¸ì–´ê°€ ì§€ì›ë˜ì§€ë§Œ Java/Spring ê¸°ë°˜ì˜ í”„ë¡œì íŠ¸ë¡œ ì§„í–‰í•˜ê³  ìˆê¸°ì— Java11ë¡œ ì§„í–‰í–ˆë‹¤.

Java11ì€ ì½˜ì†” ì°½ì—ì„œ ë°”ë¡œ í¸ì§‘í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ë”°ë¡œ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ê·¸ ì•ˆì— í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ê³  .zipíŒŒì¼ë¡œ ë¹Œë“œí•˜ëŠ” ê³¼ì •ì„ ê±°ì³ì•¼ í•œë‹¤.

ìš°ì„  ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ê³  ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì¤˜ì•¼ í•œë‹¤.

[.zip íŒŒì¼ ì•„ì¹´ì´ë¸Œ ë°°í¬](https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/java-package.html#java-package-cli)ë¥¼ ì°¸ê³ í•˜ì—¬ build.gradleì—” ì•„ë˜ì™€ ê°™ì€ ì¢…ì†ì„±ì„ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.

```
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    implementation platform('software.amazon.awssdk:bom:2.15.0')
    implementation 'software.amazon.awssdk:s3'
    implementation 'com.amazonaws:aws-lambda-java-core:1.2.2'
    implementation 'com.amazonaws:aws-lambda-java-events:3.11.1'
    implementation 'com.amazonaws:aws-java-sdk-s3:1.12.429'
    implementation 'com.google.code.gson:gson:2.10.1'
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.9.2'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.9.2'
}
```

<br>

ë‹¤ìŒìœ¼ë¡œ, `Handler.java` í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³ , ê·¸ ì•ˆì— ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• í•¨ìˆ˜ë¥¼ ë§Œë“¤ë©´ ëœë‹¤.

ë¦¬ì‚¬ì´ì§• ë¡œì§ì€ ì˜ˆì‹œ ì½”ë“œ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¤ê³ , `jpeg`ì™€ `gif` íƒ€ì…ì— ê´€í•œ ê²ƒë§Œ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.

<details>
<summary>Handler.java</summary>
<div markdown="1">

```java
public class Handler implements RequestHandler<S3Event, String> {
    private static final float MAX_DIMENSION = 100;
    private final String REGEX = ".*\\.([^\\.]*)";
    private final String JPG_TYPE = (String) "jpg";
    private final String JPG_MIME = (String) "image/jpeg";
    private final String JPEG_TYPE = (String) "jpeg";
    private final String JPEG_MIME = (String) "image/jpeg";
    private final String PNG_TYPE = (String) "png";
    private final String PNG_MIME = (String) "image/png";
    private final String GIF_TYPE = (String) "gif";
    private final String GIF_MIME = (String) "image/gif";

    @Override
    public String handleRequest(S3Event s3event, Context context) {
        LambdaLogger logger = context.getLogger();
        try {
            S3EventNotificationRecord record = s3event.getRecords().get(0);

            String srcBucket = record.getS3().getBucket().getName();

            // Object key may have spaces or unicode non-ASCII characters.
            String key = record.getS3().getObject().getUrlDecodedKey();

            String dstBucket = srcBucket + "-resized";
            String dstKey = "resized-" + key;

            // Infer the image type.
            Matcher matcher = Pattern.compile(REGEX).matcher(key);
            if (!matcher.matches()) {
                logger.log("Unable to infer image type for key " + key);
                return "";
            }
            String imageType = matcher.group(1);
            if (!(JPG_TYPE.equals(imageType)) && !(JPEG_TYPE.equals(imageType))
                    && !(PNG_TYPE.equals(imageType)) && !(GIF_TYPE.equals(imageType))) {
                logger.log("Skipping non-image " + key);
                return "";
            }

            // Download the image from S3 into a stream
            S3Client s3Client = S3Client.builder().build();
            InputStream s3Object = getObject(s3Client, srcBucket, key);

            // Read the source image
            BufferedImage srcImage = ImageIO.read(s3Object);
            BufferedImage newImage = resizeImage(srcImage);

            // Re-encode image to target format
            ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
            ImageIO.write(newImage, imageType, outputStream);

            // Upload new image to S3
            putObject(s3Client, outputStream, dstBucket, dstKey, imageType, logger);

            logger.log(
                    "Successfully resized " + srcBucket + "/" + key + " and uploaded to " + dstBucket
                            + "/" + dstKey);
            return "Ok";
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }

    private void putObject(S3Client s3Client, ByteArrayOutputStream outputStream,
                           String bucket, String key, String imageType, LambdaLogger logger) {

        Map<String, String> metadata = new HashMap<>();
        metadata.put("Content-Length", Integer.toString(outputStream.size()));
        if (JPG_TYPE.equals(imageType)) {
            metadata.put("Content-Type", JPG_MIME);
        }
        if (PNG_TYPE.equals(imageType)) {
            metadata.put("Content-Type", PNG_MIME);
        }
        if (JPEG_TYPE.equals(imageType)) {
            metadata.put("Content-Type", JPEG_MIME);
        }
        if (GIF_TYPE.equals(imageType)) {
            metadata.put("Content-Type", GIF_MIME);
        }

        software.amazon.awssdk.services.s3.model.PutObjectRequest putObjectRequest = PutObjectRequest.builder()
                .bucket(bucket)
                .key(key)
                .metadata(metadata)
                .build();

        // Uploading to S3 destination bucket
        logger.log("Writing to: " + bucket + "/" + key);
        try {
            s3Client.putObject(putObjectRequest,
                    RequestBody.fromBytes(outputStream.toByteArray()));
        }
        catch(AwsServiceException e)
        {
            logger.log(e.awsErrorDetails().errorMessage());
            System.exit(1);
        }

    }

    private InputStream getObject(S3Client s3Client, String bucket, String key) {
        software.amazon.awssdk.services.s3.model.GetObjectRequest getObjectRequest = software.amazon.awssdk.services.s3.model.GetObjectRequest.builder()
                .bucket(bucket)
                .key(key)
                .build();
        return s3Client.getObject(getObjectRequest);
    }

    private BufferedImage resizeImage(BufferedImage srcImage) {
        int srcHeight = srcImage.getHeight();
        int srcWidth = srcImage.getWidth();
        // Infer scaling factor to avoid stretching image unnaturally
        float scalingFactor = Math.min(
                MAX_DIMENSION / srcWidth, MAX_DIMENSION / srcHeight);
        int width = (int) (scalingFactor * srcWidth);
        int height = (int) (scalingFactor * srcHeight);

        BufferedImage resizedImage = new BufferedImage(width, height,
                BufferedImage.TYPE_INT_RGB);
        Graphics2D graphics = resizedImage.createGraphics();
        // Fill with white before applying semi-transparent (alpha) images
        graphics.setPaint(Color.white);
        graphics.fillRect(0, 0, width, height);
        // Simple bilinear resize
        graphics.setRenderingHint(RenderingHints.KEY_INTERPOLATION,
                RenderingHints.VALUE_INTERPOLATION_BILINEAR);
        graphics.drawImage(srcImage, 0, 0, width, height, null);
        graphics.dispose();
        return resizedImage;
    }
}
```
</div>
</details>

<br>

### 4. ë°°í¬ íŒ¨í‚¤ì§€ ë¹Œë“œ
---

í•¨ìˆ˜ë¥¼ ë‹¤ ì‘ì„±í–ˆìœ¼ë©´ .zipíŒŒì¼ë¡œ buildí•´ì•¼ í•œë‹¤.

[Gradleì„ ì‚¬ìš©í•˜ì—¬ ë°°í¬ íŒ¨í‚¤ì§€ ë¹Œë“œ](https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/java-package.html#java-package-cli) ê³µì‹ë¬¸ì„œì— ë”°ë¥´ë©´ gradle ë¹Œë“œì˜ ê²½ìš° `build.gradle`ì— ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ buildì‹œ .zipíŒŒì¼ì´ ìƒì„±ëœë‹¤ê³  í•œë‹¤.

```
task buildZip(type: Zip) {
    from compileJava
    from processResources
    into('lib') {
        from configurations.runtimeClasspath
    }
}
build.dependsOn buildZip
```
ìœ„ ì½”ë“œë¥¼ ì ì‹œ ì„¤ëª…í•˜ë©´, `build/distributions` ë””ë ‰í„°ë¦¬ì— ë°°í¬ íŒ¨í‚¤ì§€ë¥¼ ìƒì„±í•œë‹¤. 

`compileJava` ì‘ì—…ì€ í•¨ìˆ˜ì˜ í´ë˜ìŠ¤ë¥¼ ì»´íŒŒì¼í•˜ë©°, ì´ `processResources` ì‘ì—…ì€ Java í”„ë¡œì íŠ¸ ë¦¬ì†ŒìŠ¤ë¥¼ ëŒ€ìƒ ë””ë ‰í„°ë¦¬ì— ë³µì‚¬í•˜ê³  ì ì¬ì ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.

ê·¸ëŸ° ë‹¤ìŒ `into('lib')` ëª…ë ¹ì´ ë¹Œë“œì˜ í´ë˜ìŠ¤ ê²½ë¡œì—ì„œ libë¼ëŠ” í´ë”ë¡œ ì¢…ì†ì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë³µì‚¬í•˜ê²Œ ëœë‹¤.

<br>

`build.gradle`ì— ì‘ì„±ì´ ëë‚¬ë‹¤ë©´ `build`í•œ ë’¤,

![image](https://user-images.githubusercontent.com/85394884/231561010-a10168a4-6cae-4b62-9e65-98b3d95ef5da.png)

`build/distributions` ë””ë ‰í„°ë¦¬ì— .zip íŒŒì¼ì´ ìƒì„±ëëŠ”ì§€ í™•ì¸í•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231561155-8db64d1f-6031-4fb0-9d7d-f7a46953734f.png)


<br>

### 5. Lambda í•¨ìˆ˜ ìƒì„±
---

ë¹Œë“œí•œ ë°°í¬ íŒ¨í‚¤ì§€ë¥¼ Lambdaì— ë“±ë¡í•˜ê¸° ìœ„í•œ ê³¼ì •ì€ [Lambda ë°°í¬ íŒ¨í‚¤ì§€](https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/gettingstarted-package.html#gettingstarted-package-zip)ë¥¼ ì°¸ê³ í–ˆë‹¤.

Lambda ì½˜ì†”ì„ ì‚¬ìš©í•´ì„œ .zipíŒŒì¼ì„ ì—…ë¡œë“œí•´ë³´ê² ë‹¤.
![image](https://user-images.githubusercontent.com/85394884/231674676-bca93011-387b-41a8-a74b-a3ec9610c263.png)

<br>

ìš°ì„ , `Lambda > í•¨ìˆ˜ > í•¨ìˆ˜ ìƒì„±`ì—ì„œ `ìƒˆë¡œ ì‘ì„±`ì„ ì„ íƒí•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231561348-4d0df3a6-58d2-4d62-b0e7-5c1f07d7c26a.png)

<br>

ê¸°ë³¸ ì •ë³´ì—ëŠ” ì ì ˆí•œ ì´ë¦„ê³¼ Java 11, ì—­í• ì—” ì•ì„œ ìƒì„±í•œ `lambda-s3-role`ì„ ì„ íƒí•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231561473-9afeb13d-713d-43cc-bea8-b64033ef7e4c.png)

<br>

ë‹¤ìŒìœ¼ë¡œ, ì½”ë“œ ì†ŒìŠ¤ì— `.zip` í˜¹ì€ `.jar`íŒŒì¼ë¡œ ì—…ë¡œë“œí•˜ë©´ ë˜ëŠ”ë°,

![image](https://user-images.githubusercontent.com/85394884/231563178-1326a295-8f30-407b-8562-083563ef8356.png)

<br>

ìš©ëŸ‰ì´ 10MBë¥¼ ì´ˆê³¼í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ S3ë¥¼ ì‚¬ìš©í•´ì„œ ì—…ë¡œë“œ í•˜ë¼ê³  í•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231563081-af858809-a8d3-47ca-a30a-79fe59d8e7cc.png)

<br>

ê·¸ë˜ì„œ ì„ì˜ì˜ S3 ë²„í‚·ì„ ìƒˆë¡œ ìƒì„±í•´ì„œ .zipíŒŒì¼ì„ ì—…ë¡œë“œ í›„ í•´ë‹¹ .zipíŒŒì¼ ê°ì²´ URLì„ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ìœ¼ë¡œ ì§„í–‰í•´ì•¼ í•œë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ ì„ì˜ì˜ S3 ë²„í‚·ì„ ìƒì„±í•˜ê³ , zipíŒŒì¼ì„ ì—…ë¡œë“œí–ˆë‹¤.
![image](https://user-images.githubusercontent.com/85394884/231564121-8a383620-882d-4099-a9ac-d6fa219d6947.png)

<br>

ê·¸ëŸ¬ë©´ ë‹¤ì‹œ ëŒì•„ì™€ì„œ Lambda ì½”ë“œ ì†ŒìŠ¤ì— í•´ë‹¹ ê°ì²´ URLì„ ì…ë ¥í•˜ë©´ ëœë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231564594-4db13b72-9112-47e6-9c9c-2af8df5ed9d8.png)

<br>

ê·¸ë¦¬ê³ , ëŸ°íƒ€ì„ ì„¤ì •ì˜ í•¸ë“¤ëŸ¬ ê°’ì„ `[íŒ¨í‚¤ì§€ëª….í´ë˜ìŠ¤ëª…::ë©”ì„œë“œëª…]`ìœ¼ë¡œ ì„¤ì •í•˜ê³  ë“±ë¡í•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231564382-671eb0a5-1cd6-4613-b541-20029c9cbfee.png)


![image](https://user-images.githubusercontent.com/85394884/231565102-8c1d84da-e2de-4152-899b-5ff3e0c8c0ae.png)

<br>

### 6. Amazon S3 íŠ¸ë¦¬ê±°ë¥¼ ìƒì„±
---

í•œ ê°€ì§€ ê³¼ì •ì´ ë” ë‚¨ì•„ìˆë‹¤.

ìš°ë¦¬ê°€ Lambdaì— ë“±ë¡í•´ ë‘” í•¨ìˆ˜ë¥¼ ì–¸ì œ ì‹¤í–‰í• ê±´ì§€ì— ê´€í•œ ì„¤ì •ì„ í•´ì£¼ì–´ì•¼ í•œë‹¤.

Amazon S3 íŠ¸ë¦¬ê±°ë¥¼ ì‚¬ìš©í•˜ì—¬ Lambda í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ê²ƒì´ê³ , [Amazon S3 íŠ¸ë¦¬ê±°ë¥¼ ì‚¬ìš©í•˜ì—¬ Lambda í•¨ìˆ˜ í˜¸ì¶œ](https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/with-s3-example.html)ì˜ ìˆœì„œë¥¼ ì°¸ê³ í–ˆë‹¤.

ë¬¸ì„œì— ë‚˜ì™€ ìˆëŠ” ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
![image](https://user-images.githubusercontent.com/85394884/231677231-4b73c843-e366-45b5-94ca-993536d815a2.png)

<br>

í•¨ìˆ˜ ê°œìš” ì—ì„œ íŠ¸ë¦¬ê±° ì¶”ê°€ë¥¼ í´ë¦­ í•œ ë’¤,

![image](https://user-images.githubusercontent.com/85394884/231565350-9123738e-35d3-44c8-bef5-c3639806791b.png)

<br>

S3ë¥¼ ì†ŒìŠ¤ë¡œ ì„ íƒí•œë‹¤.

ë²„í‚·ì€ `ì´ë¯¸ì§€ë¥¼ ë³€í™˜í•  ëŒ€ìƒ ë²„í‚·`ì„ ì„ íƒí•œë‹¤. 

ê·¸ë¦¬ê³ , ì´ë²¤íŠ¸ ìœ í˜•ì€ `ëª¨ë“  ê°ì²´ ìƒì„± ì´ë²¤íŠ¸`ë¥¼ ì„ íƒí•˜ê³ , ì¬ê·€ í˜¸ì¶œ ê²½ê³ ë¥¼ ì²´í¬ í•œë’¤, íŠ¸ë¦¬ê±°ë¥¼ ì¶”ê°€í•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231678372-0918dfde-9d83-41d0-8354-d5651276fb23.png)

<br>

### 7. ìš”ì²­ í™•ì¸
---

ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ì´í‚¤ ë¡œê³  ë¸Œëœë“œ ìƒì„± ìš”ì²­ì„ ë³´ë‚´ë©´,

![image](https://user-images.githubusercontent.com/85394884/231680602-92a2e3f2-c9d7-45ca-bb97-9176c324afd9.png)

<br>

ì›ë³¸ ì´ë¯¸ì§€ê°€ `shoekream` ë²„í‚·ì˜ `brand` í´ë”ì— `250.6KB` ìš©ëŸ‰ìœ¼ë¡œ ì €ì¥ë˜ê³ ,

![image](https://user-images.githubusercontent.com/85394884/231681126-2b1a57bc-013a-4170-a87b-f111583ef37a.png)

<br>

ë¦¬ì‚¬ì´ì§• ì´ë¯¸ì§€ëŠ” `shoekream-resized` ë²„í‚·ì˜ `resized-brand` í´ë”ì— `1.4KB` ìš©ëŸ‰ìœ¼ë¡œ ì €ì¥ë˜ì—ˆë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231680981-a79655ff-9a48-48e9-b97d-cbbbd64b020d.png)

<br>

`ëª¨ë‹ˆí„°ë§ > ë¡œê·¸ > CloudWatch Logs`ë¥¼ ì‚´í´ë³´ë©´, ì‘ì„±í•œ íŠ¸ë¦¬ê±°ê°€ ì‹¤í–‰ë˜ì–´ Lambdaê°€ ì •ìƒì ìœ¼ë¡œ í˜¸ì¶œë˜ì—ˆê³ , ê·¸ ê²°ê³¼ì¸ ë¦¬ì‚¬ì´ì§• ì‘ì—…ì´ ì˜ ì´ë£¨ì–´ì¡ŒìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/85394884/231681836-176b10fb-6f6d-4886-9cbb-a272e5000cc6.png)

<br>

### ë§ˆë¬´ë¦¬
---

ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ë™ì‹œì— ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì™€ì•¼ í•œë‹¤ë©´ ì´ë¯¸ì§€ í¬ê¸°ê°€ ë¡œë”© ì†ë„ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆê³ , ì¸ë„¤ì¼ í˜¹ì€ ë¯¸ë¦¬ë³´ê¸°ì™€ ê°™ì€ ê³³ì—ì„œë„ í¬ê¸°ê°€ í° ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ê³„ì†í•´ì„œ ìš”ì²­í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ëŠ” ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.

ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ëŠ” ë¡œì§ì„ ë‚´ ì„œë²„ ì•ˆì—ì„œ ì‘ì„±í•  ìˆ˜ë„ ìˆê² ì§€ë§Œ ê·¸ëŸ¬í•œ ë°©ë²•ì€ ë™ì‹œì— ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ì¤„ì—¬ì•¼ í•˜ê¸°ì—” ì„œë²„ì˜ ë¶€í•˜ê°€ ì‹¬í•´ì ¸ ì í•©í•œ ë°©ë²•ì€ ì•„ë‹ˆë‹¤.

ê·¸ë˜ì„œ ì„œë²„ë¦¬ìŠ¤ Faasì¸ AWS Lambdaë¥¼ ì´ìš©í•˜ê²Œ ë˜ì—ˆë‹¤.

ë‚´ê°€ ì²˜ë¦¬í•´ì•¼ í•  ì´ë¯¸ì§€ í¬ê¸° ì¡°ì • ì‘ì—…ì„ AWS Lambdaì— í•¨ìˆ˜ë¡œ ë“±ë¡í•´ë‘ë©´, Lambdaê°€ íŠ¹ì • ì¡°ê±´ì´ ë§Œì¡±í•  ë•Œ í•´ë‹¹ ì‘ì—…ì„ ì‹¤í–‰ì‹œì¼œ ë¦¬ì‚¬ì´ì§• ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê²Œ ëœë‹¤.

ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ ì´ë¯¸ì§€ í¬ê¸° ì¡°ì • ì‘ì—…ì„ ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ ë¡œì§ì—ì„œ ì‹¤í–‰í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì„œë²„ì˜ ë¶€í•˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆê³ , ëª©ì ì— ë§ëŠ” ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆê¸°ì— ì—¬ëŸ¬ ì´ë¯¸ì§€ê°€ í¬í•¨ëœ ì›¹ í˜ì´ì§€ì˜ ë¡œë”© ì†ë„ë¥¼ ë¹ ë¥´ê²Œ í•  ìˆ˜ ìˆë‹¤.


## References

* [ììŠµì„œ: Amazon S3 íŠ¸ë¦¬ê±°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ë„¤ì¼ ì´ë¯¸ì§€ ìƒì„±](https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/with-s3-tutorial.html)
* [ììŠµì„œ: Amazon S3 íŠ¸ë¦¬ê±°ë¥¼ ì‚¬ìš©í•˜ì—¬ Lambda í•¨ìˆ˜ í˜¸ì¶œ](https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/with-s3-example.html)
* [ëŒë‹¤(Lambda) ê°œë… & ì‚¬ìš©ë²• ğŸ’¯ ì´ì •ë¦¬](https://inpa.tistory.com/entry/AWS-%F0%9F%93%9A-%EB%9E%8C%EB%8B%A4Lambda-%EA%B0%9C%EB%85%90-%EC%9B%90%EB%A6%AC?category=947446)
* [AWS S3 + Vue.js + SpringBoot(3) - CDN, Lambda ì ìš©í•˜ê¸°](https://kjw1313.tistory.com/76)
* [Lambdaë¥¼ ì´ìš©í•œ Image Resizing](https://velog.io/@dltkdgus1850/AWS-Lambda%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-Image-Resizing)