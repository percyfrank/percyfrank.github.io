---
title:  "Spring Bootì™€ AWS S3ë¥¼ ì—°ë™í•œ íŒŒì¼ ì—…ë¡œë“œ(2)" 
excerpt: "S3 ë²„í‚·ì„ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ ì—…ë¡œë“œ"

categories:
  - Springboot
tags:
  - [Springboot, Project]

date: 2023-01-25
last_modified_at: 2023-01-25

---

### 0. Intro
---

[ì´ì „ ê²Œì‹œë¬¼](https://percyfrank.github.io/springboot/S301/)ì—ì„œ íŒŒì¼ ì—…ë¡œë“œë¥¼ ìœ„í•œ ì‚¬ì „ ì‘ì—…ì„ ë§ˆë¬´ë¦¬í•˜ì˜€ë‹¤.

ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ AWS S3 ìƒì„±ë¶€í„° íŒŒì¼ ì—…ë¡œë“œê¹Œì§€ ì§„í–‰í•´ë³´ì.

<br>

### 1. AWS S3 ë²„í‚· ìƒì„±
---

ë²„í‚·ì„ ìƒì„±í•˜ê¸°ì— ì•ì„œ, S3 ë²„í‚·ì˜ ê°œë…ì„ ê°„ë‹¨íˆ ì•Œì•„ë³´ì.

S3ì—ëŠ” Bucket(ë²„í‚·)ê³¼ Object(ê°ì²´)ë¼ëŠ” ê°œë…ì´ ë“±ì¥í•œë‹¤.
- ì—¬ê¸°ì„œ ê°ì²´ëŠ” ë°ì´í„°ì™€ ë©”íƒ€ë°ì´í„°ë¥¼ êµ¬ì„±í•˜ê³  ìˆëŠ” ì €ì¥ ë‹¨ìœ„ì´ë©°,
- ë²„í‚·ì€ ì´ëŸ¬í•œ ê°ì²´ë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

ê·¸ë˜ì„œ S3ë¥¼ êµ¬ì„±í•  ë•Œ, ë²„í‚·ì„ ë†“ì„ Regionì„ ì„ íƒí•˜ê³ , í•´ë‹¹ ë²„í‚· ì•ˆì— ê°ì²´í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬ì„±í•œë‹¤.

ê·¸ë ‡ê¸° ë•Œë¬¸ì—, S3ì— ì €ì¥ë˜ëŠ” ë°ì´í„°ëŠ” ëª¨ë‘ ê°ì²´, Objectì´ë‹¤.

ì¡°ê¸ˆ ë” ì‚´í´ë³´ë©´, S3ëŠ” ëª¨ë“  ê°ì²´ë¥¼ ê´€ë¦¬í•˜ëŠ” ìµœìƒìœ„ ë””ë ‰í† ë¦¬ì´ë©° S3ì—ì„œ ë²„í‚·ì€ ì „ì„¸ê³„ì—ì„œ ìœ ì¼í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì¤‘ë³µëœ ì´ë¦„ì´ ì¡´ì¬í•  ìˆ˜ ì—†ë‹¤.

ê·¸ëŸ¼ ì§€ê¸ˆë¶€í„° ë²„í‚·ì„ ìƒì„±í•´ë³´ì.

#### 1-1. S3 ë²„í‚· ìƒì„±

ìƒì„±í•  ë²„í‚· ì´ë¦„ì„ ì…ë ¥í•  ë•Œ ì „ì„¸ê³„ì—ì„œ ìœ ì¼í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ëˆ„êµ°ê°€ ìƒì„±í•œ ë²„í‚· ì´ë¦„ìœ¼ë¡œëŠ” ìƒì„±í•  ìˆ˜ ì—†ë‹¤. 

ë²„í‚· ë¦¬ì „ì€ ì•„ë§ˆ `ì•„ì‹œì•„ íƒœí‰ì–‘(ì„œìš¸) ap-northeast-2`ë¡œ ì„¤ì •ë˜ì–´ ìˆì„ ê²ƒì´ë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214573449-0b63e4cd-cd86-41b4-ae62-6152d49881a4.png)

ê°ì²´ ì†Œìœ ê¶Œê³¼ í¼ë¸”ë¦­ ì•¡ì„¸ìŠ¤ ì°¨ë‹¨ ì„¤ì •ì€ Default ì„¤ì • ê·¸ëŒ€ë¡œ ë‘ê³  ìƒì„±í•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214571638-3ce09ccc-640f-48f3-97ce-c62b59f9562c.png)
![image](https://user-images.githubusercontent.com/85394884/214571670-85de9164-6696-4498-b2ca-5957c2f47ef1.png)


ìƒì„±í•˜ê³ , í•´ë‹¹ ë²„í‚· ì°½ì— ë“¤ì–´ê°€ë©´, ì¤‘ê°„ì— í´ë” ë§Œë“¤ê¸°ë¥¼ í†µí•´ í´ë”ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤. 

ë‚˜ëŠ”, ì´ë¯¸ `test`ë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ì—ˆì§€ë§Œ, ì²˜ìŒ ìƒì„±í•œ ì‚¬ëŒì€ ì•„ë¬´ê²ƒë„ ëœ¨ì§€ ì•Šì„ ê²ƒì´ë‹¤.

âœ… ì—¬ê¸°ì„œ í´ë”ëŠ” Spring Bootì™€ ì—°ë™í•  ë•Œ íŒŒì¼ì„ ì €ì¥í•  ë””ë ‰í† ë¦¬ ê²½ë¡œì— ì‚¬ìš©í•  ê²ƒì´ë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214573804-495c2e6b-57ea-4a28-9749-811012944c2c.png)

![image](https://user-images.githubusercontent.com/85394884/214574932-af7ae3c8-9dca-4654-97a8-31745bbbda2a.png)

<br>

### 2. Springboot ì„¤ì •
---

ì´ì œ ê°œë°œìš© IAM ê³„ì •í–ˆê³ , S3 ë²„í‚·ë„ ìƒì„±í–ˆìœ¼ë‹ˆ, Springbootë‘ ì—°ë™í•´ë³´ì.

#### 2-1. ìŠ¤í”„ë§ í´ë¼ìš°ë“œ ì˜ì¡´ì„± ì¶”ê°€

Spring Cloud AWSë¥¼ ì‚¬ìš©í•˜ë©´ S3ë¥¼ í†µí•œ íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

ì¸í…”ë¦¬ì œì´ í•˜ë‹¨ì— Dependenciesë¥¼ í†µí•´ í•´ë‹¹ Springboot í”„ë¡œì íŠ¸ì— ê°€ì¥ ì í•©í•œ ì˜ì¡´ì„± ë²„ì „ì„ ì¶”ê°€í•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214575569-376a5599-b1e1-4baf-8915-28af02eacb0d.png)


#### 2-2. application.yml ì„¤ì •

ë‹¤ìŒìœ¼ë¡œ, application.ymlíŒŒì¼ì— ì´ì „ì— ê°œë°œìš© IAM ì‚¬ìš©ìì™€ S3 ë²„í‚·ì„ ìƒì„±í•˜ë©´ì„œ ë°œê¸‰ë°›ì€ ì—‘ì„¸ìŠ¤ í‚¤, ë¹„ë°€ ì—‘ì„¸ìŠ¤ í‚¤, ë²„í‚· ì´ë¦„, ë²„í‚· ë¦¬ì „ì„ ì…ë ¥í•´ì¤€ë‹¤.

ğŸš¨ í•´ë‹¹ ì •ë³´ë“¤ì€ ì™¸ë¶€ì— ê³µê°œë˜ë©´ ì•ˆë˜ë¯€ë¡œ yml íŒŒì¼ì—” ê°€ì§œ ì •ë³´ë¥¼ ì˜¬ë¦¬ê³ , Edit Configurationì„ í†µí•´ í™˜ê²½ë³€ìˆ˜ë¡œ ì…ë ¥í•´ì¤€ë‹¤.

```yaml

cloud:
  aws:
    credentials:
      accessKey: ${AWS_ACCESS_KEY_ID}       # AWS IAM AccessKey
      secretKey: ${AWS_SECRET_ACCESS_KEY}   # AWS IAM SecretKey
    s3:
      bucket: bucket    # ë²„í‚· ì´ë¦„
    region:
      static: ap-northeast-2
    stack:
      auto: false

```

![image](https://user-images.githubusercontent.com/85394884/214577417-728e1197-9b82-48f9-8f63-616eddba358b.png)


#### 2-3. AWS ì„¤ì • ì •ë³´ í´ë˜ìŠ¤

`AwsConfig.java`

```java

@Configuration
public class AwsConfig {

    @Value("${cloud.aws.credentials.accessKey}")
    private String accessKey;

    @Value("${cloud.aws.credentials.secretKey}")
    private String secretKey;

    @Value("${cloud.aws.region.static}")
    private String region;

    @Bean
    public AmazonS3Client amazonS3Client() {
        AWSCredentials awsCredentials = new BasicAWSCredentials(accessKey, secretKey);
        return (AmazonS3Client) AmazonS3ClientBuilder.standard()
                .withRegion(region)
                .withCredentials(new AWSStaticCredentialsProvider(awsCredentials))
                .build();
    }

}
```
ymlì— ë“±ë¡í•œ ì—‘ì„¸ìŠ¤ í‚¤, ë¹„ë°€ ì—‘ì„¸ìŠ¤ í‚¤, ë¦¬ì „ì„ Beanìœ¼ë¡œ ë“±ë¡í•´ì¤€ë‹¤.


#### 2-4. Entity

S3 ë²„í‚·ì— ê°™ì€ ì´ë¦„ì˜ íŒŒì¼ì´ ì—…ë¡œë“œë˜ë©´ ë‚˜ì¤‘ì— ë“±ë¡ëœ íŒŒì¼ì´ ë®ì–´ì“°ëŠ” ë¬¸ì œê°€ ìƒê¸´ë‹¤.

ê·¸ë˜ì„œ, S3 ë²„í‚·ì— ì €ì¥ë˜ëŠ” íŒŒì¼ ì´ë¦„ì´ ì¤‘ë³µë˜ì§€ ì•Šë„ë¡ ì €ì¥ëœ íŒŒì¼ì˜ URLì„ ë‚˜íƒ€ë‚´ëŠ” í•„ë“œì¸ `storeFileUrl`ë¥¼ ì¶”ê°€í–ˆë‹¤.

ê·¸ë¦¬ê³  ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ íŒŒì¼ ì´ë¦„ì„ ë‚˜íƒ€ë‚´ëŠ” `uploadFileName`í•„ë“œë„ ì¶”ê°€í–ˆë‹¤.

ìµœì´ˆ íŒŒì¼ ì—…ë¡œë“œ ì‹œê°„, ë§ˆì§€ë§‰ ìˆ˜ì • ì‹œê°„, ì‚­ì œ ì‹œê°„ì„ ìœ„í•´ `BaseEntity` í´ë˜ìŠ¤ë¥¼ ìƒì†í–ˆë‹¤.

`File.java`

```java

@Entity
@AllArgsConstructor
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Builder
@Getter
@ToString(callSuper = true)
@EqualsAndHashCode(callSuper = true)
@SQLDelete(sql = "UPDATE upload_file SET deleted_at = CURRENT_TIMESTAMP where id = ?")
public class File extends BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String uploadFileName;
    private String storeFileUrl;

    public File(String uploadFileName, String storeFileUrl) {
        this.uploadFileName = uploadFileName;
        this.storeFileUrl = storeFileUrl;
    }
}
```

#### 2-5. Controller

MultipartFile ê°ì²´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì™€ì„œ Service Layerì— ìš”ì²­ì„ ì „ë‹¬í•œë‹¤.

í˜„ì¬ëŠ”, íŒŒì¼ ì²¨ë¶€ê°€ í•˜ë‚˜ë§Œ ê°€ëŠ¥í•˜ì§€ë§Œ, ì¶”í›„ì— ì—¬ëŸ¬ ê°œì˜ íŒŒì¼ ì²¨ë¶€ë„ ê°€ëŠ¥í•˜ê²Œ ë³€ê²½í•  ìƒê°ì´ë‹¤.

`FileController.java`

```java
@RequiredArgsConstructor
@RestController
@Slf4j
public class FileController {

    private final S3UploadService s3UploadService;

    @PostMapping("/upload")
    public ResponseEntity<Response<UploadFileResponse>> uploadFile(@RequestParam MultipartFile multipartFile) throws IOException {
        log.info("íŒŒì¼ ë“±ë¡ ì™„ë£Œ");
        return ResponseEntity.ok().body(Response.success(s3UploadService.saveUploadFile(multipartFile)));
    }
}
```

![image](https://user-images.githubusercontent.com/85394884/214580944-a87ca3e1-5db9-4145-bed4-757f1d0c0edd.png)

#### 2-6. Service 

`S3UploadService.java`

```java
@Service
@RequiredArgsConstructor
public class S3UploadService {

    private final AmazonS3Client amazonS3Client;
    private final FileRepository fileRepository;

    @Value("${cloud.aws.s3.bucket}")
    private String bucket;

    @Transactional
    public UploadFileResponse saveUploadFile(MultipartFile multipartFile) throws IOException {

        ObjectMetadata objectMetadata = new ObjectMetadata();
        objectMetadata.setContentType(multipartFile.getContentType());
        // íŒŒì¼ í¬ê¸° ì„¤ì •
        objectMetadata.setContentLength(multipartFile.getSize());

        // íŒŒì¼ ì´ë¦„
        String originalFilename = multipartFile.getOriginalFilename();
        int index = originalFilename.lastIndexOf(".");
        String ext = originalFilename.substring(index + 1);

        // ì €ì¥ë  íŒŒì¼ ì´ë¦„
        String storeFileName = UUID.randomUUID() + "." + ext;
        // ì €ì¥í•  ë””ë ‰í† ë¦¬ ê²½ë¡œ + íŒŒì¼ ì´ë¦„
        String key = "test/" + storeFileName;

        try (InputStream inputStream = multipartFile.getInputStream()) {
            amazonS3Client.putObject(new PutObjectRequest(bucket, key, inputStream, objectMetadata)
                    .withCannedAcl(CannedAccessControlList.PublicRead));
        }

        String storeFileUrl = amazonS3Client.getUrl(bucket, key).toString();
        File file = new File(originalFilename, storeFileUrl);
        File savedFile = fileRepository.save(file);

        return UploadFileResponse.of(savedFile);
    }
}
```

ì•ì„œ, Spring Cloud AWSë¥¼ ì‚¬ìš©í•˜ë©´, AmazonS3Client Beanì€ ìë™ ìƒì„±ë˜ê¸° ë•Œë¬¸ì—, ë”°ë¡œ AWS ì„¤ì • ì •ë³´ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì£¼ì§€ ì•Šì•„ë„ ëœë‹¤.

ë‚˜ëŠ” ë‚˜ì¤‘ì— ì•Œì•„ë²„ë ¤ì„œ... ë‚˜ì¤‘ì— ë¹¼ëŠ” ë°©í–¥ìœ¼ë¡œ ë°”ê¿”ë³´ë„ë¡ í•˜ê² ë‹¤.

ì½”ë“œ ìˆœì„œëŒ€ë¡œ ì„¤ëª…í•´ë³´ë©´,

- ObjectMetadata ê°ì²´ì— content-lengthì™€ sizeë¥¼ ì§€ì •í•œë‹¤. ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ warning ë¡œê·¸ ë°œìƒ.
- íŒŒì¼ ì´ë¦„ê³¼ UUIDë¡œ ìƒì„±í•œ ëœë¤ ê°’ì„ í•©ì³ì„œ S3ì— ì €ì¥ë  íŒŒì¼ ì´ë¦„ì„ ë§Œë“ ë‹¤.
- ê·¸ë¦¬ê³ , í•´ë‹¹ íŒŒì¼ì„ ì´ì „ì— ë²„í‚· ìƒì„± ì‹œ í´ë”ë¥¼ ìƒì„±í–ˆëŠ”ë°, í•´ë‹¹ í´ë”ì— ì €ì¥ë˜ë„ë¡ í•œë‹¤.
- ë²„í‚·, ì €ì¥í•  ë””ë ‰í† ë¦¬ + íŒŒì¼ì´ë¦„ ë“±ì˜ ë°ì´í„°ì™€ ë©”íƒ€ë°ì´í„°ë¥¼ AmazonS3Client Beanì— ì£¼ì…í•˜ê³ , `withCannedAcl` ë©”ì„œë“œë¥¼ í†µí•´ ì—…ë¡œë“œí•œ íŒŒì¼ì„ ëª¨ë‘ê°€ ì½ì„ ìˆ˜ ìˆê²Œ ì„¤ì •í•œë‹¤.
- ë§ˆì§€ë§‰ìœ¼ë¡œ, `getUrl` ë©”ì„œë“œë¥¼ í†µí•´ S3ì— ì—…ë¡œë“œëœ ì‚¬ì§„ URLì„ ê°€ì ¸ì™€ File Entityì— ì €ì¥í•œë‹¤.

#### 2-7. Repository, DTO 

RepositoryëŠ” JpaRepsitoryë¥¼ ìƒì†ë°›ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ìƒì„±í•œë‹¤.

ë°˜í™˜ DTOì—ì„œ ì„±ê³µ ë©”ì„¸ì§€ì™€ í•¨ê»˜ ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ íŒŒì¼ ì´ë¦„ì„ ë°˜í™˜í•˜ë„ë¡ í•œë‹¤.

`FileRepository.java`
```java
@Repository
public interface FileRepository extends JpaRepository<File, Long> {
}
```

`UploadFileResponse.java`
```java
@Getter
@Builder
public class UploadFileResponse {

    private String uploadFileName;
    private String message;

    public static UploadFileResponse of(File file) {
        return UploadFileResponse.builder()
                .uploadFileName(file.getUploadFileName())
                .message("íŒŒì¼ ì²¨ë¶€ ì™„ë£Œ")
                .build();
    }
}

```

<br>

### 3. ì—ëŸ¬ í•´ê²°
---

ì—¬ê¸°ì„œ ìš”ì²­ì„ ë‚ ë ¸ì„ ë•Œ ë˜ë©´ ì¢‹ê² ì§€ë§Œ, ì´ˆê¸°ì— S3 ë²„í‚·ì„ ìƒì„±í•  ë•Œ, Default ì„¤ì •ìœ¼ë¡œ ì§„í–‰í•´ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤.

#### 3-1. ì—…ë¡œë“œ íŒŒì¼ ìš©ëŸ‰ ì´ˆê³¼ ì—ëŸ¬

íŒŒì¼ ì—…ë¡œë“œ ìš”ì²­ì„ ë³´ë‚´ë©´, ë‹¤ìŒê³¼ ê°™ì´ `Maximum upload size exceeded` ë¬¸êµ¬ê°€ ëœ¬ë‹¤.

ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ìš©ëŸ‰ì„ ë„˜ê¸´ íŒŒì¼ì„ ì—…ë¡œë“œ í•˜ë ¤ê³  í•  ë•Œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ì¸ë°, Default ê°’ì´ 
ì•½ 1MBë¼ê³  í•œë‹¤. ë‚´ê°€ ì—…ë¡œë“œí•˜ë ¤ê³  í–ˆë˜ íŒŒì¼ì´ 1.1MBë¼ ì—ëŸ¬ê°€ ë‚¬ë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214586180-7482a393-d1f4-4176-b459-a1649192cbb7.png)

![image](https://user-images.githubusercontent.com/85394884/214587268-3c54600d-9cdd-4384-abd8-a24b68973f64.png)


ë‚˜ëŠ” SpringBoot 2.xë²„ì „ì´ê¸° ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì´ [`application.yml` íŒŒì¼ì—ì„œ ì„¤ì •](https://velog.io/@jinho_pca/Spring-Boot-%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C-%EC%9A%A9%EB%9F%89%EC%A0%9C%ED%95%9C-%EC%84%A4%EC%A0%95)ì„ ì¶”ê°€í•˜ë©´ ëœë‹¤.

```yaml
servlet:
  multipart:
    max-file-size: 50MB
    max-request-size: 50MB
```

#### 3-2. SdkClientException ì—ëŸ¬

ìš©ëŸ‰ ì¡°ì ˆì„ í•´ì£¼ì—ˆëŠ”ë°ë„ ì´ ì—ëŸ¬ëŠ” ì—¬ì „íˆ ëœ¬ë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214587728-7559ebc5-bd80-4ac1-b5ab-8932c8a7cb28.png)

ì‚¬ì‹¤, ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ìì²´ì—ëŠ” ë¬¸ì œê°€ ì—†ì–´ ë„˜ì–´ê°ˆ ìˆ˜ ìˆëŠ” ì—ëŸ¬ì§€ë§Œ, í”„ë¡œì íŠ¸ë¥¼ Run í•  ë•Œë§ˆë‹¤ ì‹œê°„ì´ ë”œë ˆì´ ë˜ë©´ì„œ ë²„ë²…ê±°ë¦°ë‹¤.

í•´ë‹¹ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ”, build.gradleì— spring-cloud-starter-aws ì˜ì¡´ì„± ì£¼ì…ì‹œ ë¡œì»¬í™˜ê²½ì€ AWS í™˜ê²½ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì´ë¼ê³  í•œë‹¤.

ë°©ë²•ì€ 2ê°€ì§€ê°€ ìˆë‹¤.
1. ë¡œê·¸ë§Œ ì•ˆë³´ì´ê²Œ í•˜ê¸° - ì—¬ì „íˆ ë”œë ˆì´ëŠ” ë¨. ë¡œê·¸ë§Œ ì•ˆ ë³´ì¼ ë¿
2. âœ… AWSê°€ ì•„ë‹Œ í™˜ê²½ì˜ ì‹œìŠ¤í…œ í™˜ê²½ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ ì£¼ê¸° - ì±„íƒ


Edit Configurationì—ì„œ `vm options`ì— `-Dcom.amazonaws.sdk.disableEc2Metadata=true`ë¥¼ ì…ë ¥í•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214589246-74072e81-f986-400d-a9e6-a50eecdbb5f0.png)

ë‹¤ì‹œ Runí•˜ë©´...
EC2 ë©”íƒ€ë°ì´í„°ë¥¼ ì œì™¸í•˜ê³  ì‹¤í–‰í•œë‹¤ëŠ” ì˜ë¯¸ì˜ ì—ëŸ¬ë¡œ ë³€ê²½ë˜ì—ˆë‹¤. ì¦‰, ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œ ë”œë ˆì´ê°€ ë”ì´ìƒ ì—†ë‹¤ëŠ” ì˜ë¯¸ê°€ ëœë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214589686-6da2d1b9-aab7-4b64-8c78-97242db72b33.png)

#### 3-3. The bucket does not allow ACLs (Service: Amazon S3; Status Code: 400; Error Code: AccessControlListNotSupported ì—ëŸ¬

í•´ë‹¹ ì—ëŸ¬ëŠ” ê°„ë‹¨í•˜ë‹¤. 

ì´ˆê¸°ì— S3 ë²„í‚· ìƒì„± ì‹œì— ë²„í‚·ì˜ ê°ì²´ ì†Œìœ ê¶Œ(ACL)ì„ ë¹„í™œì„±í™”ì‹œí‚¨ ìƒíƒœë¡œ ìƒì„±í–ˆê¸° ë•Œë¬¸ì— ë°œìƒí•œ ê²ƒì´ë‹¤.

ë²„í‚· > ê°ì²´ ì†Œìœ ê¶Œ í¸ì§‘ ì—ì„œ ACL í™œì„±í™” ì‹œí‚¤ë©´ ëœë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214590762-e2db2962-670f-448c-a5d2-5520f8af7069.png)


#### 3-4. AWS S3 403 Forbidden ì—ëŸ¬

ì´ ì—ëŸ¬ë„ ë§ˆì°¬ê°€ì§€ë¡œ ì´ˆê¸° ë²„í‚· ìƒì„± ì‹œì— ë²„í‚· ì •ì±…ì„ ì„¤ì •í•´ì£¼ì§€ ì•Šì•„ì„œ ë°œìƒí–ˆë‹¤.

1. ë¨¼ì €, í¼ë¸”ë¦­ ì—‘ì„¸ìŠ¤ ì°¨ë‹¨ì„ ìˆ˜ì •í•œë‹¤.

`ê¶Œí•œ -> í¼ë¸”ë¦­ ì•¡ì„¸ìŠ¤ ì°¨ë‹¨ -> í¸ì§‘ -> ì²´í¬ ëª¨ë‘ í•´ì œ -> ë³€ê²½ì‚¬í•­ ì €ì¥` 

ì•„ë§ˆ Default ì„¤ì • ê·¸ëŒ€ë¡œ ë²„í‚·ì„ ìƒì„±í–ˆë‹¤ë©´ `ëª¨ë“  í¼ë¸”ë¦­ ì—‘ì„¸ìŠ¤ ì°¨ë‹¨`ì— í´ë¦­ì´ ë˜ì–´ ìˆì„ ê²ƒì´ë‹¤. ëª¨ë‘ í’€ì–´ì£¼ì.

![image](https://user-images.githubusercontent.com/85394884/214591547-8f2db5aa-a1a7-4f04-b836-cd98622f2c78.png)

2. ë‹¤ìŒìœ¼ë¡œ, ë²„í‚· ì •ì±…ì„ í¸ì§‘í•´ì•¼ í•œë‹¤.

`ê¶Œí•œ -> ë²„í‚·ì •ì±… -> í¸ì§‘ -> ë²„í‚·ì •ì±…`

ë²„í‚· ì •ì±… í¸ì§‘ì—ì„œ ë²„í‚· ARNì„ ë³µì‚¬í•˜ê³ , ì˜¤ë¥¸ìª½ ìƒë‹¨ì— ìˆëŠ” ì •ì±… ìƒì„±ê¸° ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214592481-fa13a8e8-57cf-40ac-8bb9-9580b3a5d67b.png)

3. ë²„í‚· ì •ì±… ìƒì„±

ì •ì±… ìƒì„±ê¸° ë²„íŠ¼ì„ í´ë¦­í–ˆë‹¤ë©´ ì •ì±… ìƒì„± í˜ì´ì§€ê°€ ë‚˜ì˜¨ë‹¤.
- Select Type of Policy - `S3 Bucket Policy`
- Principal - `*`
- Actions - `GetObject` 
- ARN - ë³µì‚¬í•œ ë²„í‚· ARN ë’¤ì— `/*`ì¶”ê°€í•œë’¤, `Add Statement`ë¥¼ í´ë¦­í•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214593247-6114bd5b-eb33-4a87-b04a-02a3191eee5d.png)

`Generate Policy`ë¥¼ í´ë¦­í•˜ë©´

![image](https://user-images.githubusercontent.com/85394884/214593986-83b3d334-a203-441f-a08f-cf5bef60b453.png)

JSON íƒ€ì…ì˜ ì •ì±…ì´ ìƒì„±ë˜ê³ , í•´ë‹¹ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ì²˜ìŒì˜ ë²„í‚· ì •ì±… í¸ì§‘ ì°½ì— ë¶™ì—¬ë„£ê³  ì €ì¥í•œë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214594103-24f10b1d-7c61-485c-b8e7-9865f8119eaa.png)


### ìµœì¢… íŒŒì¼ ì—…ë¡œë“œ ìš”ì²­

ì´ì œ, íŒŒì¼ ì—…ë¡œë“œ ìš”ì²­ì„ ë³´ë‚´ë©´, íŒŒì¼ ì²¨ë¶€ë˜ì—ˆë‹¤ëŠ” ì„±ê³µ ë©”ì„¸ì§€ì™€ í•¨ê»˜ S3 ë²„í‚·ì˜ test í´ë”ì— íŒŒì¼ì´ ì €ì¥ë˜ê³ , DBì—ë„ ì €ì¥ëœ íŒŒì¼ì˜ URLê³¼ ì‚¬ìš©ìê°€ ì €ì¥í•  ë•Œì˜ íŒŒì¼ ì´ë¦„ì´ ì €ì¥ëœë‹¤.

![image](https://user-images.githubusercontent.com/85394884/214594975-0b6561b1-7a72-41fa-ac11-5da7dc49e8de.png)

![image](https://user-images.githubusercontent.com/85394884/214595506-900dbcb1-1c90-4e04-a38a-995185cfd7f1.png)

![image](https://user-images.githubusercontent.com/85394884/214595652-648d57db-b820-4616-909f-369d343d8843.png)

## References

* [ S3 ê°œë… & ë²„í‚· Â· ê¶Œí•œ ì„¤ì • ë°©ë²•](https://inpa.tistory.com/entry/AWS-%F0%9F%93%9A-S3-%EB%B2%84%ED%82%B7-%EC%83%9D%EC%84%B1-%EC%82%AC%EC%9A%A9%EB%B2%95-%EC%8B%A4%EC%A0%84-%EA%B5%AC%EC%B6%95)
* [SpringBoot & AWS S3 ì—°ë™í•˜ê¸°](https://jojoldu.tistory.com/300)
* [Spring Bootì™€ S3ë¥¼ ì—°ë™í•œ íŒŒì¼ ì—…ë¡œë“œ](https://velog.io/@louie/S3%EB%A5%BC-%EC%97%B0%EB%8F%99%ED%95%9C-%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C)
* [AWS - S3 ì‚¬ìš©í•˜ê¸° (ë²„í‚· ë§Œë“¤ê¸°)](https://velog.io/@jinseoit/AWS-S3-bucket)
* [com.amazonaws.SdkClientException: Failed to connect to service endpoint ì—ëŸ¬ - (aws ì˜ì¡´ì„± ì£¼ì…ì‹œ ì—ëŸ¬)](https://thalals.tistory.com/289)
* [springboot multipart íŒŒì¼ ì—…ë¡œë“œ ìš©ëŸ‰ ì´ˆê³¼ ì—ëŸ¬ í•´ê²° ë°©ë²•](https://velog.io/@jinho_pca/Spring-Boot-%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C-%EC%9A%A9%EB%9F%89%EC%A0%9C%ED%95%9C-%EC%84%A4%EC%A0%95)
* [s3 acls ì˜¤ë¥˜](https://www.inflearn.com/questions/374465/s3-acls-%EC%98%A4%EB%A5%98)
* [ì•„ë§ˆì¡´ AWS S3 403 Forbidden ì—ëŸ¬ í•´ê²°ë°©ë²•](https://wakestand.tistory.com/300)


