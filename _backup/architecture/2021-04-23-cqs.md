---
title: "CQS(Command Query Separation)"
excerpt: "CQS 준수를 통해 명령형 언어에서 함수형 언어의 장점을 제한적으로 누릴 수 있다."
categories:
  - DDD
tags:
  - DDD
toc: true
toc_sticky: true
last_modified_at: 2021-04-23
---

## 1. Query와 Command

함수는 시스템의 상태를 바꾸는지 여부에 따라 크게 두 가지로 분류될 수 있다. Query는 결과값을 반환할 뿐 관찰 가능한 시스템의 상태를 변화시키지 않는다. 따라서 사이드 이펙트가 없다. Command는 결과를 반환하지는 않지만 시스템의 상태를 변경시킨다.

Query는 '질의'라는 뜻으로 질문에 대한 답을 반환하는 것으로, Command는 '명령'이라는 뜻으로 질의에 비해 어떤 **액션**을 기대하는 바가 크다고 볼 수 있다. 여기서 액션이란 실제 시스템의 상태를 영구적으로 바꾸는 행위이다. 이러한 특징으로 Command를 Modifier 혹은 Mutator 등으로 표현하기도 한다.

Query 함수는 안전하기 때문에 별다른 주의를 기울이지 않고도 사용할 수 있다. 반면에 상태를 바꾸는 Command 함수는 부주의하게 실행하는 경우 사이드 이펙트가 발생할 수 있기 때문에 함수간 사용 순서를 고민해야 한다.

<br>

## 2. CQS(Command Query Separation)

CQS는 함수가 가급적 Command와 Query 중 한 가지 역할만을 해야한다는 원칙이다. 질의를 수행하는 함수가 시스템의 상태를 변경시키는 등 부수 효과를 유발하면 예측 불가능한 버그가 발생하기 쉽다. CQS 준수를 통해 부수 효과가 존재하는 명령형 언어에서 부수 효과가 없는 함수형 언어의 장점을 제한적으로 누릴 수 있게 된다.

> ResultSet.java

```java
/*
Moves the cursor forward one row from its current position. A ResultSet cursor is initially positioned before the first row; the first call to the method next makes the first row the current row; the second call makes the second row the current row, and so on.
When a call to the next method returns false, the cursor is positioned after the last row.
*/
boolean next() throws SQLException;
```

* JDBC에서 사용하는 ResultSet 클래스의 ``next()`` 메서드는 DB 데이터 테이블의 커서를 옮김과 동시에, 다음 행이 존재하는지 유무를 반환한다.

> Test.java

```java
ResultSet resultSet;
if (resultSet.next()) {
    return;
}
List<String> list = new ArrayList<>();
while (resultSet.next()) {
    String source = resultSet.getString("source");
    list.add(source);
    //... 중략
}
```

* Command와 Query가 혼용되고 있으며 이를 단순한 Query로 인식하여 사용하는 경우, 원하지 않는 부수 효과로 인해 버그가 발생한다.
* 위 코드는 ``next()`` 메서드가 다음 행이 존재하는지 유무를 반환하는 Query로 인식하여 사용한 예제이다.
  * if 조건문에서 이미 커서가 한 번 이동하기 때문에, 반복문 수행 결과 한 행이 누락되게 된다.

<br>

---

## References

* [Command와 Query, CQS 알아보기](https://shoark7.github.io/programming/knowledge/command-and-query-method)
