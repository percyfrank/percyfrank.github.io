---
title: "빌드와 배포 및 CI와 CD"
excerpt: "배포와 관련된 개념들에 대해 정리해보자."
categories:
  - DevOps
tags:
  - DevOps
date: 2021-06-11
last_modified_at: 2021-06-11
---

## 1. Build

* 소스 코드 파일을 컴퓨터에서 실행할 수 있는 독립 소프트웨어 가공물로 변환하는 일련의 과정이나 결과물을 일컫는다.
  * 컴파일, 링크, Resource 등 실행에 필요한 파일을 지정된 위치로 옮기는 행위, 테스팅, JAR 혹은 WAR로의 패키징 등.
* 컴파일과 링크 등은 빌드의 여러 단계 중 한 가지에 속하는 부분 집합이다.

### 1.1. Build Tool

* 상기한 빌드 프로세스를 자동으로 수행함으로써 소스 코드를 실행 가능한 어플리케이션으로 생성해주는 도구다.
* 프로젝트 규모가 확대될수록 사용하는 라이브러리가 많아진다.
  * 라이브러리를 직접 다운받아서 추가하는 등 수동 작업이 매우 번거롭고 실수가 발생하기 쉽다.
* 빌드 툴은 라이브러리를 자동으로 추가 및 관리해준다.
  * 라이브러리의 버전을 자동으로 동기화하는 기능도 제공한다.
* Gradle, Maven 등이 있다.

<br>

## 2. Deploy

* 빌드를 통해 완성한 JAR 혹은 WAR 등의 실행 가능한 파일을 일반 사용자가 접근할 수 있는 환경에 배치하는 행위다.
  * Tomcat 등 Web Application Server(운영 서버)에 파일을 올리는 것이다.

<br>

## 3. CI(Continuous Integration)

* 어플리케이션의 새로운 코드 변경 사항이 정기적으로 빌드 및 테스트 되어 공유 레포지토리에 통합히는 것이다.
  * 새로운 소스 코드의 빌드, 테스트, 병합의 정기화 및 자동화를 의미한다.
* 모든 개발이 끝난 이후에 코드 품질을 관리하는 고전적 방식의 단점을 해소하기위해 나타난 개념이다.
  * 개발을 하면서 ‘코드에 대한 통합’을 ‘지속적’으로 진행함으로써 품질을 유지하는 개념이다.

### 3.1. 필요성

* 여러 팀원들이 참여하는 프로젝트에서 코드를 수동으로 통합하는 과정은 상당히 번거롭다.
  * Git 등 형상 관리 시스템에 코드를 올리고, 중앙 코드와 통합시킨다.
  * 통합된 코드가 잘 동작하는지 테스트를 수행한다.
  * 통합된 코드가 잘 빌드되는지 테스트한다.
  * 결과를 정리하고, 버그가 있다면 기록해 팀원에게 공유한다.
* 코드와 테스트가 많아질수록 시간이 오래 걸리며, 사람이 개별적으로 수행하기에는 대단히 반복적인 작업이다.
* Git에 코드만 올리면 자동으로 테스트와 빌드를 수행하고, 결과를 기록하여 고지해주는 프로그램이 있으면?
  * Travis, Jenkins 등의 CI 툴은 이러한 수동 통합 과정을 정기화 및 자동화해준다.
  * 안정적인 배포 파일을 만드는 과정이다.

<br>

## 4. CD(Continuous Deploy)

* 개발자의 코드 변경 사항이 레포지토리를 넘어, 고객의 프로덕션(Production) 환경까지 릴리즈 되는 것을 의미한다.
* 소프트웨어가 항상 신뢰 가능한 수준에서 배포될 수 있도록 지속적으로 관리하자는 개념이다.
* CI 빌드 결과를 자동으로 테스트 서버와 운영 서버에 배포해 반영하는 것이다.

<br>

## 5. 무중단 배포

* 8080 포트에서 배포 중인 서버가 존재하는데, 새롭게 배포할 내용이 있다고 가정하자.
* 포트 충돌을 막기 위해 잠시 서버를 다운시킨다.
* 8080 포트에 새롭게 배포할 서버를 띄운다.
* 새롭게 서버를 배포하는데 드는 시간 만큼 클라이언트는 서비스를 이용하지 못하고 불편함을 느낀다.
  * 다운 타임이 없는 무중단 배포를 통해 이러한 문제를 해결한다.

### 5.1. 전제 조건

* 두 대 이상의 서버(혹은 서버 어플리케이션)를 서비스해야 한다.
* 다운타임이 발생하지 않으려면 실제 서비스 중인 서버와 새롭게 배포한 서버가 동시에 존재해야 한다.
* 비용을 줄이려면 배포할 때만 새롭게 서버를 띄우고, 배포가 완료된 후에 기존 서버는 죽이면 된다.

### 5.2. Rolling Deployment

![image](https://user-images.githubusercontent.com/56240505/121572651-5fa0a700-ca5f-11eb-9a97-c344d649afac.png)

* 원리
  * 서버 1을 로드 밸런서에서 뺀다.
  * 서버 1을 배포한다.
  * 서버 1을 다시 로드 밸런서에 넣는다.
  * 서버 2를 로드 밸런서에서 뺀다.
  * 서버 2에 배포한다.
  * 서버 2를 다시 로드 밸런서에 넣는다.
  * (모든 서버가 배포 완료 될 때 까지 계속 진행한다.)
* 배포할 서버가 너무 많다면 n대 단위로 배포하는데, 배포가 모두 끝나기 전까지는 누구는 이전 서비스를 받고 누구는 신규 서비스를 받는 문제가 존재한다.
  * 서버마다 서비스가 달라질 수 있다.
* 1대에 배포하는 것 보다 최소 2배 이상 느리다.

### 5.3. Canary Deploy

![image](https://user-images.githubusercontent.com/56240505/121572987-b27a5e80-ca5f-11eb-9d52-0cc50a022945.png)

* 소수의 유저만 사용하는 환경에 신규 버전을 배포하고, 문제가 없다고 판단됐을 때 다른 모든 서버에 배포한다.

### 5.4. Blue/Green Deploy

![image](https://user-images.githubusercontent.com/56240505/121573569-5d8b1800-ca60-11eb-8ad2-f9a30f61794e.png)

* 실제로 서비스 중인 환경(Blue)과 새롭게 배포할 환경(Green)을 세트로 준비해서 배포하는 방식을 말한다.
* 장점
  * 새롭게 배포할 환경에만 (동시에) 배포하면 되기 때문에 배포 속도가 매우 빠르다.
  * 언제나 Green 환경이 떠있기 떄문에, 만약 잘못된 버전으로 배포한 경우 신속하게 롤백할 수 있다.
* 단점
  * Green 환경이 항상 떠있어야 하기 때문에 비용이 2배로 든다.

<br>

---

## References

* [무중단 배포란...?](https://perfectacle.github.io/2019/04/21/non-stop-deployment/)
* [빌드와 배포](https://startupdevelopers.tistory.com/237)
* [[QA] CI/CD 란?](https://itholic.github.io/qa-cicd/)
